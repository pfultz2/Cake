set(CAKE_FILE "Cakefile")

function(parse_cake_file CAKE_FILE VAR)
    file(STRINGS ${CAKE_FILE} CAKE_FILE_LINES)
    set(CURRENT_LIST_VAR "")
    foreach(line ${CAKE_FILE_LINES})
        separate_arguments(tokens UNIX_COMMAND "${line}")
        foreach(token ${tokens})
            if (token MATCHES "//|#") 
                break()
            endif()
            if (token MATCHES ":$")
                message(STATUS "Token matches: ${token}")
                string(REGEX MATCH "[a-zA-Z0-9_]+" keyword ${token})
                string(TOUPPER ${keyword} CURRENT_LIST_VAR)
            else()
                message(STATUS "Appending list: ${VAR}_${CURRENT_LIST_VAR} ${token}")
                list(APPEND ${VAR}_${CURRENT_LIST_VAR} ${token})
                set(${VAR}_${CURRENT_LIST_VAR} "${${VAR}_${CURRENT_LIST_VAR}}" PARENT_SCOPE)
            endif()
        endforeach()
    endforeach()
endfunction()

parse_cake_file(${CAKE_FILE} PKG)

message(STATUS "PKG_EXE: ${PKG_EXE}")
